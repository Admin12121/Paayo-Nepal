# Development Dockerfile with hot reload
FROM rust:1.75-alpine

RUN apk add --no-cache musl-dev openssl-dev pkgconfig

# Install cargo-watch for hot reload
RUN cargo install cargo-watch

WORKDIR /app

# Create uploads directory
RUN mkdir -p /app/uploads

# Copy dependencies first for caching
COPY Cargo.toml Cargo.lock ./

# Create a dummy main.rs to build dependencies
RUN mkdir src && echo "fn main() {}" > src/main.rs
RUN cargo build
RUN rm -rf src

# The actual source will be mounted as a volume
EXPOSE 8080

# Use cargo-watch for hot reload
CMD ["cargo", "watch", "-x", "run"]
